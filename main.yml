- hosts: localhost
  tasks:

    - name: Set OS and environment facts
      set_fact:
        is_ci: "{{ ansible_env.TRAVIS_JOB_ID is defined }}"
        isnt_ci: "{{ ansible_env.TRAVIS_JOB_ID is not defined }}"
        is_osx: "{{ ansible_os_family == 'Darwin' }}"
        is_linux: "{{ ansible_system == 'Linux' }}"
        is_ubuntu: "{{ ansible_distribution == 'Ubuntu' }}"
      tags: always

    - name: Set Ubuntu version facts
      set_fact:
        is_ubuntu13_plus: "{{ is_ubuntu and ansible_distribution_version|int >= 13 }}"
        is_ubuntu15_plus: "{{ is_ubuntu and ansible_distribution_version|int >= 15 }}"
      tags: always

- hosts: localhost
  vars:
    - node_version: 6
  tasks:

    # essentials:
    - include: tasks/apt.yml
    #- include: tasks/homebrew.yml
    - include: tasks/core.yml
    #- include: tasks/dotfiles.yml

    # Install programming languages
    - include: tasks/python.yml
    - include: tasks/golang.yml
    - include: tasks/node.yml
      when: is_osx
      tags: node

    # - include: tasks/erlang.yml
    #   when: is_ubuntu
    #   tags:
    #    - erlang
    #    - elixir

    # Docker installs Kernel updates, install before other software
    - include: tasks/docker.yml

    # Install Vagrant and Virtualbox early as well
    - include: tasks/vagrant.yml
    - include: tasks/virtualbox.yml

    # Firewall
    - include: tasks/ufw.yml
      when: is_ubuntu

    # specific stuff than can be commented out:
    - include: tasks/atom.yml
    - include: tasks/awscli.yml
      tags: aws
    
    - include: tasks/corebird.yml
      when: is_ubuntu
    - include: tasks/gitkraken.yml
      tags: gitkraken
      
    - include: tasks/google-cloud-sdk.yml
    - include: tasks/chrome.yml    
    - include: tasks/dbeaver.yml

    - include: tasks/firefox.yml
    # - include: tasks/diffmerge.yml
    # - include: tasks/dropbox.yml
    # - include: tasks/google-drive.yml
    # - include: tasks/intellij.yml
    # - include: tasks/ngrok.yml
    # - include: tasks/postgres.yml
    - include: tasks/packer.yml
      tags: packer

    - include: tasks/playdeb.yml
    - include: tasks/pycharm.yml
    # - include: tasks/quicklook.yml
    # - include: tasks/ruby.yml
    # - include: tasks/skype.yml

    - include: tasks/slack.yml
      when: is_osx
    - include: tasks/scudcloud.yml
      when: is_ubuntu

    # - include: tasks/slate.yml
    - include: tasks/spotify.yml
    # - include: tasks/sublime-text.yml
    - include: tasks/telegram.yml
    - include: tasks/terminal.yml
    - include: tasks/terraform.yml
      tags: terraform

    # Using markosamuli.visual-studio-code instead
    # - include: tasks/visual-studio-code.yml
    - include: tasks/vlc.yml
    - include: tasks/vpn.yml
      tags: vpn

    # - include: tasks/whatsapp.yml
  
- hosts: localhost
  vars:
    - nodejs_version: 6.x
    - erlang_version: 19.2
  roles:

    - role: nodesource.node
      when: is_ubuntu
      tags: 
      - node

    - role: markosamuli.visual-studio-code
      tags: 
      - visual-studio-code
      - vscode

    # The role fails if trying to run it on OS X
    - role: kbrebanov.erlang
      when: is_ubuntu
      tags:
      - elixir
      - erlang

- hosts: localhost
  tasks:
    # Needs to be instaled after Erlang on Ubuntu
    - include: tasks/elixir.yml
      tags: 
       - elixir